# Default values for cluster-serverless-infra
# Infrastructure ArgoCD Applications for GitOps-powered serverless platform
# Optimized for VPS/Homelab deployments

# Global configuration
global:
  clusterName: cluster-serverless
  domain: benedict-aryo.com
  environment: production

# Cilium CNI configuration
# eBPF-based networking and security  
# Managed by cluster-init (not cluster-serverless-infra)
cilium:
  enabled: false  # Managed separately by cluster-init
  version: "1.18.4"
  
  # Replace kube-proxy with eBPF (set to false for compatibility)
  kubeProxyReplacement: false
  
  # Hubble observability
  hubble:
    enabled: true
    relay:
      enabled: true
    ui:
      enabled: false  # Disable UI for resource savings

# Sealed Secrets Controller
# Encrypt secrets for Git storage
sealedSecrets:
  enabled: true
  version: "v0.33.1"

# Knative Serving configuration
# Serverless request-driven workloads
# Managed via Knative Operator CRs
knativeServing:
  enabled: true
  version: "1.17.1"
  
  # Kourier ingress (enabled via operator)
  ingress:
    kourier:
      enabled: true

# Knative Eventing configuration  
# Event-driven architecture
# Managed via Knative Operator CRs
knativeEventing:
  enabled: true
  version: "1.17.0"

# OpenTelemetry configuration
# Metrics and trace collection
opentelemetry:
  enabled: true
  namespace: observability
  
  collector:
    mode: deployment
    replicas: 1
    
    # Collector configuration
    config:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
            http:
              endpoint: 0.0.0.0:4318
      
      processors:
        batch:
          timeout: 10s
          send_batch_size: 1024
      
      exporters:
        jaeger:
          endpoint: jaeger-collector.observability.svc.cluster.local:14250
          tls:
            insecure: true
        
        prometheus:
          endpoint: 0.0.0.0:8889
      
      service:
        pipelines:
          traces:
            receivers: [otlp]
            processors: [batch]
            exporters: [jaeger]
          metrics:
            receivers: [otlp]
            processors: [batch]
            exporters: [prometheus]
    
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

# Jaeger configuration
# Distributed tracing UI
jaeger:
  enabled: true
  namespace: observability
  strategy: allInOne  # Simple deployment for VPS/homelab
  
  # Storage configuration
  storage:
    type: memory
    options:
      memory:
        maxTraces: 100000
  
  # UI access
  ui:
    enabled: true
    service:
      type: ClusterIP
  
  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1024Mi

# Cloudflare Tunnel configuration
# Secure external access without exposed ports
cloudflareTunnel:
  enabled: true  # Enabled - sealed secret in templates/cloudflare-tunnel/secret.yaml
  namespace: cloudflare-tunnel
  
  # Replica count for HA
  replicas: 2
  
  # Credentials (SealedSecret deployed via GitOps)
  # To update token:
  # 1. Get new token from Cloudflare Zero Trust dashboard
  # 2. Create new sealed secret (see templates/cloudflare-tunnel/secret.yaml comments)
  # 3. Commit and push to Git
  credentials:
    useExistingSecret: false  # SealedSecret is managed in templates/
    secretName: cloudflare-tunnel-secret
  
  # Ingress rules (configured automatically)
  ingress:
    - hostname: "*.benedict-aryo.com"
      service: http://kourier-gateway.kourier-system.svc.cluster.local:80
    
    # ArgoCD access
    - hostname: argocd.benedict-aryo.com
      service: https://argocd-server.argocd.svc.cluster.local:443
      originRequest:
        noTLSVerify: true
    
    # Jaeger UI access
    - hostname: jaeger.benedict-aryo.com
      service: http://jaeger-query.observability.svc.cluster.local:16686
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

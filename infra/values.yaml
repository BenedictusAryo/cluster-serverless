# Default values for cluster-serverless-infra
# Infrastructure ArgoCD Applications for GitOps-powered serverless platform
# Optimized for VPS/Homelab deployments

# Global configuration
global:
  clusterName: cluster-serverless
  domain: benedict-aryo.com
  environment: production

# Cilium CNI configuration
# eBPF-based networking and security  
# Deployed as ArgoCD Application
cilium:
  enabled: true
  version: "1.18.4"
  
  # Replace kube-proxy with eBPF (set to false for compatibility)
  kubeProxyReplacement: false
  
  # Hubble observability
  hubble:
    enabled: true
    relay:
      enabled: true
    ui:
      enabled: false  # Disable UI for resource savings

# Sealed Secrets Controller
# Encrypt secrets for Git storage
sealedSecrets:
  enabled: true
  version: "v0.33.1"

# Knative Serving configuration
# Serverless request-driven workloads
knativeServing:
  enabled: true
  version: "1.17.1"

# Knative Eventing configuration  
# Event-driven architecture
knativeEventing:
  enabled: true
  version: "1.17.0"

# Kourier Ingress configuration
# Lightweight alternative to Istio
kourier:
  enabled: true
  version: "1.17.0"
  
  # Service configuration
  service:
    type: ClusterIP  # Internal only, exposed via Cloudflare Tunnel
    annotations: {}
  
  # Gateway resources
  gateway:
    replicas: 2  # HA setup
    resources:
      requests:
        cpu: 100m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 128Mi

# OpenTelemetry configuration
# Metrics and trace collection
opentelemetry:
  enabled: true
  namespace: observability
  
  collector:
    mode: deployment
    replicas: 1
    
    # Collector configuration
    config:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
            http:
              endpoint: 0.0.0.0:4318
      
      processors:
        batch:
          timeout: 10s
          send_batch_size: 1024
      
      exporters:
        jaeger:
          endpoint: jaeger-collector.observability.svc.cluster.local:14250
          tls:
            insecure: true
        
        prometheus:
          endpoint: 0.0.0.0:8889
      
      service:
        pipelines:
          traces:
            receivers: [otlp]
            processors: [batch]
            exporters: [jaeger]
          metrics:
            receivers: [otlp]
            processors: [batch]
            exporters: [prometheus]
    
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

# Jaeger configuration
# Distributed tracing UI
jaeger:
  enabled: true
  namespace: observability
  strategy: allInOne  # Simple deployment for VPS/homelab
  
  # Storage configuration
  storage:
    type: memory
    options:
      memory:
        maxTraces: 100000
  
  # UI access
  ui:
    enabled: true
    service:
      type: ClusterIP
  
  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1024Mi

# Cloudflare Tunnel configuration
# Secure external access without exposed ports
cloudflareTunnel:
  enabled: false  # Enable after creating sealed secret
  namespace: cloudflare-tunnel
  
  # Tunnel configuration (set after creation)
  tunnelName: k0s-homelab-tunnel
  tunnelId: ""  # Set this to your tunnel ID from Cloudflare
  accountId: ""  # Set this to your Cloudflare account ID
  
  # Replica count for HA
  replicas: 2
  
  # Credentials (use sealed secret)
  # Create with: kubectl create secret generic cloudflare-tunnel-secret \
  #   --from-literal=tunnel-token=YOUR_TOKEN \
  #   -n cloudflare-tunnel
  credentials:
    useExistingSecret: true
    secretName: cloudflare-tunnel-secret
  
  # Ingress rules (configured automatically)
  ingress:
    - hostname: "*.benedict-aryo.com"
      service: http://kourier-gateway.kourier-system.svc.cluster.local:80
    
    # ArgoCD access
    - hostname: argocd.benedict-aryo.com
      service: https://argocd-server.argocd.svc.cluster.local:443
      originRequest:
        noTLSVerify: true
    
    # Jaeger UI access
    - hostname: jaeger.benedict-aryo.com
      service: http://jaeger-query.observability.svc.cluster.local:16686
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi
